import{o as n,e as s,f as i,a as A,n as w,aj as ie,d as re,ak as se,al as ae,O as le,am as de,g as o,c as p,w as l,l as _,i as d,x as U,U as $,F as ue,r as ce,b as j,z as me,W as pe,m as _e,V as ve,t as fe}from"./index-bdafdd1b.js";const ge={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function he(m,e){return n(),s("svg",ge,e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6zM8 9h8v10H8zm7.5-5l-1-1h-5l-1 1H5v2h14V4z"},null,-1)]))}const ke={name:"mdi-delete-outline",render:he},we={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function ye(m,e){return n(),s("svg",we,e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7z"},null,-1)]))}const be={name:"mdi-download",render:ye},xe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ce(m,e){return n(),s("svg",xe,e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M19 12c0 3.86-3.14 7-7 7s-7-3.14-7-7s3.14-7 7-7s7 3.14 7 7"},null,-1)]))}const Re={name:"mdi-record",render:Ce},$e={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Me(m,e){return n(),s("svg",$e,e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M8 5.14v14l11-7z"},null,-1)]))}const Se={name:"mdi-play",render:Me},Ve={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Be(m,e){return n(),s("svg",Ve,e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M14 19h4V5h-4M6 19h4V5H6z"},null,-1)]))}const He={name:"mdi-pause",render:Be},Ie={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function ze(m,e){return n(),s("svg",Ie,e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M17 10.5V7a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-3.5l4 4v-11z"},null,-1)]))}const Ue={name:"mdi-video",render:ze},je={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ae(m,e){return n(),s("svg",je,e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M4 4h3l2-2h6l2 2h3a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2m8 3a5 5 0 0 0-5 5a5 5 0 0 0 5 5a5 5 0 0 0 5-5a5 5 0 0 0-5-5m0 2a3 3 0 0 1 3 3a3 3 0 0 1-3 3a3 3 0 0 1-3-3a3 3 0 0 1 3-3"},null,-1)]))}const De={name:"mdi-camera",render:Ae};function Ne({stream:m}){const e=A(()=>MediaRecorder.isTypeSupported("video/webm")),r=w(null),C=w([]),M=ie(),u=w("stopped"),v=()=>{const k=new Blob(C.value,{type:"video/webm"}),B=URL.createObjectURL(k);return C.value=[],B};return{isRecordingSupported:e,startRecording:()=>{e.value&&m.value&&u.value==="stopped"&&(r.value=new MediaRecorder(m.value,{mimeType:"video/webm"}),r.value.ondataavailable=k=>{k.data.size>0&&C.value.push(k.data)},r.value.onstop=()=>{M.trigger(v())},r.value.state==="inactive"&&(r.value.start(),u.value="recording"))},stopRecording:()=>{e.value&&r.value&&u.value!=="stopped"&&(r.value.stop(),u.value="stopped")},pauseRecording:()=>{e.value&&r.value&&u.value==="recording"&&(r.value.pause(),u.value="paused")},resumeRecording:()=>{e.value&&r.value&&u.value==="paused"&&(r.value.resume(),u.value="recording")},recordingState:u,onRecordAvailable:M.on}}const Ee={key:1,"mt-4":"",flex:"","justify-center":""},Le={flex:"","flex-col":"","gap-2":""},Pe={key:0,"mt-3":"",flex:"","justify-center":""},Te={key:1},Ye={"my-2":""},qe={flex:"","items-center":"","justify-between":"","gap-2":""},Oe={"mr-2":""},Fe={key:0,flex:"","justify-center":"","gap-2":""},Ge={"mr-2":""},We={"mr-2":""},Je={"mr-2":""},Ke={"mr-2":""},Qe={key:1,italic:"","op-60":""},Xe={grid:"","grid-cols-2":"","mt-5":"","gap-2":""},Ze=["src"],et=["src"],tt={flex:"","items-center":"","justify-between":""},nt={"font-bold":""},ot={flex:"","gap-2":""},st=re({__name:"camera-recorder",setup(m){const{videoInputs:e,audioInputs:r,permissionGranted:C,isSupported:M,ensurePermissions:u}=se({requestPermissions:!0,constraints:{video:!0,audio:!0},onUpdated(){q()}}),v=w(),b=w([]),h=w(e.value[0]?.deviceId),f=w(r.value[0]?.deviceId),V=w(!1),{stream:k,start:B,stop:D,enabled:H}=ae({constraints:A(()=>({video:{deviceId:h.value},...f.value?{audio:{deviceId:f.value}}:{}})),autoSwitch:!0}),{isRecordingSupported:N,onRecordAvailable:E,startRecording:L,stopRecording:P,pauseRecording:T,recordingState:S,resumeRecording:Y}=Ne({stream:k});E(a=>{b.value.unshift({type:"video",value:a,createdAt:new Date})});function q(){(j.isNil(h)||!e.value.find(a=>a.deviceId===h.value))&&(h.value=e.value[0]?.deviceId),(j.isNil(r)||!r.value.find(a=>a.deviceId===f.value))&&(f.value=r.value[0]?.deviceId)}function O(){if(!v.value)return;const a=document.createElement("canvas");a.width=v.value.videoWidth,a.height=v.value.videoHeight,a.getContext("2d")?.drawImage(v.value,0,0);const t=a.toDataURL("image/png");b.value.unshift({type:"image",value:t,createdAt:new Date})}le(()=>{v.value&&k.value&&(v.value.srcObject=k.value)}),de(()=>D());async function F(){try{await u()}catch{V.value=!0}}function G({type:a,value:t,createdAt:x}){const R=document.createElement("a");R.href=t,R.download=`${a}-${x.getTime()}.${a==="image"?"png":"webm"}`,R.click()}return(a,t)=>{const x=me,R=pe,g=_e,I=ve,W=De,J=Ue,K=He,Q=Se,X=Re,Z=be,ee=ke;return n(),s("div",null,[o(M)?o(C)?(n(),p(x,{key:2},{default:l(()=>[i("div",Le,[d(I,{value:o(h),"onUpdate:value":t[0]||(t[0]=c=>U(h)?h.value=c:null),"label-position":"left","label-width":"60px",label:"Video:",options:o(e).map(({deviceId:c,label:y})=>({value:c,label:y})),placeholder:"Select camera"},null,8,["value","options"]),o(f)&&o(r).length>0?(n(),p(I,{key:0,value:o(f),"onUpdate:value":t[1]||(t[1]=c=>U(f)?f.value=c:null),label:"Audio:","label-position":"left","label-width":"60px",options:o(r).map(({deviceId:c,label:y})=>({value:c,label:y})),placeholder:"Select microphone"},null,8,["value","options"])):$("",!0)]),o(H)?(n(),s("div",Te,[i("div",Ye,[i("video",{ref_key:"video",ref:v,autoplay:"",controls:"",playsinline:"","max-h-full":"","w-full":""},null,512)]),i("div",qe,[d(g,{disabled:!o(H),onClick:O},{default:l(()=>[i("span",Oe,[d(W)]),t[7]||(t[7]=_(" Take screenshot "))]),_:1},8,["disabled"]),o(N)?(n(),s("div",Fe,[o(S)==="stopped"?(n(),p(g,{key:0,onClick:o(L)},{default:l(()=>[i("span",Ge,[d(J)]),t[8]||(t[8]=_(" Start recording "))]),_:1},8,["onClick"])):$("",!0),o(S)==="recording"?(n(),p(g,{key:1,onClick:o(T)},{default:l(()=>[i("span",We,[d(K)]),t[9]||(t[9]=_(" Pause "))]),_:1},8,["onClick"])):$("",!0),o(S)==="paused"?(n(),p(g,{key:2,onClick:o(Y)},{default:l(()=>[i("span",Je,[d(Q)]),t[10]||(t[10]=_(" Resume "))]),_:1},8,["onClick"])):$("",!0),o(S)!=="stopped"?(n(),p(g,{key:3,type:"error",onClick:o(P)},{default:l(()=>[i("span",Ke,[d(X)]),t[11]||(t[11]=_(" Stop "))]),_:1},8,["onClick"])):$("",!0)])):(n(),s("div",Qe," Video recording is not supported in your browser "))])])):(n(),s("div",Pe,[d(g,{type:"primary",onClick:o(B)},{default:l(()=>t[6]||(t[6]=[_(" Start webcam ")])),_:1},8,["onClick"])]))]),_:1})):(n(),p(x,{key:1,"text-center":""},{default:l(()=>[t[5]||(t[5]=_(" You need to grant permission to use your camera and microphone ")),o(V)?(n(),p(R,{key:0,"mt-4":"","text-left":""},{default:l(()=>t[3]||(t[3]=[_(" Your browser has blocked permission request or does not support it. You need to grant permission manually in your browser settings (usually the lock icon in the address bar). ")])),_:1})):(n(),s("div",Ee,[d(g,{onClick:F},{default:l(()=>t[4]||(t[4]=[_(" Grant permission ")])),_:1})]))]),_:1})):(n(),p(x,{key:0},{default:l(()=>t[2]||(t[2]=[_(" Your browser does not support recording video from camera ")])),_:1})),i("div",Xe,[(n(!0),s(ue,null,ce(o(b),({type:c,value:y,createdAt:te},z)=>(n(),p(x,{key:z},{default:l(()=>[c==="image"?(n(),s("img",{key:0,src:y,"max-h-full":"","w-full":"",alt:"screenshot"},null,8,Ze)):(n(),s("video",{key:1,src:y,controls:"","max-h-full":"","w-full":""},null,8,et)),i("div",tt,[i("div",nt,fe(c==="image"?"Screenshot":"Video"),1),i("div",ot,[d(g,{onClick:ne=>G({type:c,value:y,createdAt:te})},{default:l(()=>[d(Z)]),_:2},1032,["onClick"]),d(g,{onClick:ne=>b.value=o(b).filter((it,oe)=>oe!==z)},{default:l(()=>[d(ee)]),_:2},1032,["onClick"])])])]),_:2},1024))),128))])])}}});export{st as default};
